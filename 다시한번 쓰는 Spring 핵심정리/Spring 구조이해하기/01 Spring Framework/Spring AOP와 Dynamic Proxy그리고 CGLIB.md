# Spring AOP와 Dynamic Proxy그리고 CGLIB

Spring AOP에서 AOP는 Aspect Oriented Programming을 의미한다. 관점 지향 프로그래밍.

여기서 Aspect 라는 단어에 주목할 필요가 있는데, Aspect는 "viewPoint"를 의미하는 것이 아닌

```scss
 프로그램 전체를 가로지르는 성질
여러 모듈에 같은 성질로 영향을 미치는 관심사
모듈의 주 기능을 옆에서 보조하는 로직
```

정도로 이해해야 한다. "관점" 이라는 단어에 사로잡히면 도대체 뭐가 관점 지향이라는 건데 라는 생각이 자칫 들 수있다.

즉, **프로그램을 분해하는 기준** 으로 이해하고 해석하는 편이 낫다.

보통 프로그램은 기능 단위(Core Concern)로 나눈다.

주문, 결제, 정산, 광고, 회원, 배송 등이 기능 단위로 취급될 수 있다. 어찌보면 도메인으로도 취급할 수 있고..

그런데 이 기능 단위의 로직에서는 여러 부수적인 작업들을 공통적으로 함께할 수 있다.

주요 기능들에 공통적으로 포함되는 것들. 가령, 로깅, 트랜잭션, 예외 처리, 성능 측정, 캐싱 등이 이에 해당한다.

사실 어찌보면 실제로 비즈니스 로직을 수행하는데 있어서 부수적인 효과를 내는 작업들이다.

하지만, 해당 비즈니스로직에서 수행되어져야할 부분이다보니 부득이하게 비즈니스 로직에 함께 포함되는 경우들이 있다.

즉, 프로그램을 보는 기준에 따라 수평적으로보면 각각의 기능 단위가 보이지만, 수직적으로 보면 그안에 세부적인 부가기능들이 보이게된다.

이게 바로 "관점"의 차이에 따라 보여지는 프로그램의 구조를 말하는 걸지도 모르겠다.

Aspect의 사전적 의미를 보면 관점과 다른 의미로 하나로써 반복을 나타내는 동사의 형태를 일컫기도 한다.

즉, 반복적으로 수행해야하는 것 이 더 맞을 수도 있겠다.

## Spring AOP
Spring AOP는 Spring Bean의 주 역할만을 충실하게 이행할 수 있도록 공통적으로 다른 관심사 부분들을 분리할 수 있는 AOP 기술을 제공한다.

우리는 이렇게 공통적으로 다루어질 수 있는 부분들을 Cross-cutting concern 이라고 부른다. 주요 기능 로직들을 가로지는 관심사를 의미한다.

일반적으로 우리가 알게 모르게 사용하는 @Transactional 애너테이션도 AOP 중 하나이다. 우리는 JDBC Datasource 관련설정만 프로퍼티에 해주면,

@Transactional 애너테이션이 자체적으로 트랜잭션을 만들어주고, 커밋 롤백 해주고, 트랜잭션을 종료까지 해준다.

너무나 당연하게 사용해왔던 그 애너테이션이 바로 이 Spring AOP를 통해 이루어지는 것이다.

Spring AOP는 Bean이 생성된 후 Proxy를 생성해주는 Bean Post Processor에 의해 프록시로 감싸질때 만들어진다.

Spring이 자체적으로 제공하는 애너테이션들 중에 이러한 AOP 기술이 적용된 것들이 더러 있다. @Transactional, @Cacheable, @Async 들이 이에 해당한다.

그리고 그외 사용자가 직접 이 AOP를 직접 구현할 수도 있다. 물론, AOP 가 동작하는 대상의 기준은 Spring Bean을 기준으로한다.

## Spring AOP 의 한계

Spring AOP는 JDK Reflection 기술인 Proxy를 기반으로 동작하는데, 때문에 기술적 제약들이 존재한다.

Spring Bean을 되어있다고 무조건적으로 AOP를 적용할 수 있는 것이 아니다.